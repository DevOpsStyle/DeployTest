---
- name: Create Azure VM
  hosts: localhost
  connection: local
  tasks:

  - name: Create a resource group
    azure_rm_resourcegroup:
      name: "{{ resource_group }}"
      location: "{{ location }}"
  - name: Create virtual network
    azure_rm_virtualnetwork:
      resource_group: "{{ resource_group }}"
      name: "{{ vm_name }}"
      address_prefixes: "{{ address_prefixes }}"
  - name: Add subnet
    azure_rm_subnet:
      resource_group: "{{ resource_group }}"
      name: "{{ vm_name }}"
      address_prefix: "{{ address_prefix }}"
      virtual_network: "{{ vm_name }}"
  - name: Create HostPool
    azure_rm_deployment:
      resource_group: "{{ resource_group }}"
      location: "{{ location }}"
      name: myDeployment
      template_link: 'https://raw.githubusercontent.com/DevOpsStyle/DeployTest/main/template.json'
      parameters_link: 'https://raw.githubusercontent.com/DevOpsStyle/DeployTest/main/parameters.json'
    become: true
    become_user: 'tommasosacco.1991@outlook.it'
    become_password: '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'
